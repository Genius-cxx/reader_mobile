webpackJsonp([6],{a6uC:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});o("PBmY");var a=o("I4Nl"),i=o.n(a),n=o("3cXf"),s=o.n(n),r=(o("miO0"),o("OTYB")),c=o.n(r),l=o("4YfN"),h=o.n(l),g=o("48sp"),u=o("AA3o"),d=o.n(u),p=function t(e){var o=e.title,a=e.content;d()(this,t),this.title=o,this.content=a},k=o("P9l9"),f={data:function(){return{bookContent:{title:"",content:""},nextContent:{title:"",content:""},prevContent:{title:"",content:""},bookCurrentPage:0,bookSourceLinks:[],loading:!1,option:!1,chapterList:[],BookSourcesId:0,listOption:!1,moreLoading:!1,changerSource:!1,SourceList:[],sourceBtn:!1,flag:!1,bookInfo:{},pattern:[{item:"默认",color:"#5c5d58",background:"#eee6dd"},{item:"夜间",color:"#666",background:"#000"},{item:"护眼",color:"#5c5d58",background:"#c8e8c8"}],offsetX:0,margin:10,currentPaging:1,resultPaging:1,prevResultPaging:1,styleObject:"",isClickPage:!1,fontSize:18,fontColor:"#5c5d58",background:"#eee6dd",readePattern:0,pagingPattern:0,bootPage:0,clWidth:document.documentElement.clientWidth||document.body.clientWidth}},computed:h()({},Object(g.b)(["book"])),beforeCreate:function(){c.a.open("加载中")},created:function(){this.getNewUser(),this.BookSourcesId=this._bookSourceId()},beforeRouteEnter:function(t,e,o){var a=JSON.parse(window.localStorage.getItem("book"))?JSON.parse(window.localStorage.getItem("book")):{};o(function(t){a[t.$route.params.id]||t.tryRead(),t.getBookSources(t.$route.params.id),t.getBook(t.$route.params.id)})},destroyed:function(){this.deleteTryRead()},mounted:function(){this.getUserLocalStorage();var t=this;window.onresize=function(){return t.clWidth=document.body.clientWidth,void t.$router.go(0)}},methods:{getNewUser:function(){var t=JSON.parse(window.localStorage.getItem("bootPage"))?JSON.parse(window.localStorage.getItem("bootPage")):{};t.bootPage?this.bootPage=t.bootPage:this.bootPage=0},setBootPage:function(){var t=JSON.parse(window.localStorage.getItem("bootPage"))&&JSON.parse(window.localStorage.getItem("bootPage"));t={bootPage:1},this.bootPage=1,window.localStorage.setItem("bootPage",s()(t))},getUserLocalStorage:function(){var t=JSON.parse(window.localStorage.getItem("userSet"))?JSON.parse(window.localStorage.getItem("userSet")):{};this.fontSize=t.fontSize,this.background=t.background,this.fontColor=t.color,this.readePattern=t.readePattern,this.pagingPattern=t.pagingPattern},setUserLocalStorage:function(){var t=JSON.parse(window.localStorage.getItem("userSet"))&&JSON.parse(window.localStorage.getItem("userSet"));t={fontSize:this.fontSize,background:this.background,color:this.fontColor,readePattern:this.readePattern,pagingPattern:this.pagingPattern},window.localStorage.setItem("userSet",s()(t))},setPaging:function(t){this.option=!this.option,this.pagingPattern=t,this.setUserLocalStorage(),1===t&&this.$nextTick(function(){var t=this.$refs.bookInner.scrollWidth,e=this.$refs.bookInner.clientWidth;this.resultPaging=Math.floor(t/e)})},setPattern:function(t,e){this.option=!0,this.readePattern=e,this.fontColor=t.color,this.background=t.background,this.setUserLocalStorage()},fontSet:function(t){if(this.option=!0,"reduce"===t){if(14===this.fontSize)return;this.fontSize-=.8,this.setUserLocalStorage()}if("add"===t){if(22===this.fontSize)return;this.fontSize+=.8,this.setUserLocalStorage()}},deleteTryRead:function(){var t=JSON.parse(window.localStorage.getItem("tBook"))?JSON.parse(window.localStorage.getItem("tBook")):{};delete t[this.$route.params.id],window.localStorage.setItem("tBook",s()(t))},tryRead:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=JSON.parse(window.localStorage.getItem("tBook"))?JSON.parse(window.localStorage.getItem("tBook")):{};e[this.$route.params.id]={id:this.bookInfo._id,bookSource:t},window.localStorage.setItem("tBook",s()(e))},addBookSelf:function(){var t=JSON.parse(window.localStorage.getItem("book"))?JSON.parse(window.localStorage.getItem("book")):{};this.flag?(delete t[this.$route.params.id],this.tryRead(this.BookSourcesId),window.localStorage.setItem("book",s()(t)),this.flag=!this.flag,i()({message:"操作成功",duration:500})):(this.deleteTryRead(),t[this.$route.params.id]={cover:this.bookInfo.cover,title:this.bookInfo.title,id:this.bookInfo._id,chapterIndexCache:this.bookCurrentPage,bookSource:this.BookSourcesId,pageIndexCache:this.currentPaging},window.localStorage.setItem("book",s()(t)),this.flag=!this.flag,i()({message:"操作成功",duration:500}))},showSource:function(){this.changerSource=!this.changerSource,this.sourceBtn=!1},_changeSource:function(t,e){this.isClickPage=!1,this.changerSource=!this.changerSource,this.moreLoading=!1,this.bookSource=[],c.a.open("加载中"),this.bookSourceLinks=[],this.BookSourcesId=e,this.currentPaging=1,this.offsetX=0,this.styleObject={transform:"translateX("+this.offsetX+"px)",transitionDuration:"0s"},this.getBookChapters(t._id),this.getBookLocalStorage()[this.$route.params.id]?this.setBookLocalStorage():this.tryRead(e)},selectChapter:function(t){this.isClickPage=!1,this.moreLoading=!1,this.loading=!0,c.a.open("加载中..."),this.bookSource=[],this.bookCurrentPage=t,this.currentPaging=1,this.offsetX=0,this.styleObject={transform:"translateX("+this.offsetX+"px)",transitionDuration:"0s"},this.getChapters(this.bookSourceLinks[t]),this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage()},setList:function(){this.listOption=!this.listOption,this.option&&(this.option=!this.option)},setReadShow:function(){this.option=!this.option},setRead:function(t){if(0!==this.pagingPattern){var e=document.documentElement.clientWidth||document.body.clientWidth,o=t.pageX,a=e/3;if(o<=a){if(0===this.bookCurrentPage&&1===this.currentPaging)return void i()("已经是第一章了！");1===this.currentPaging?(c.a.open("加载中..."),this.isClickPage=!0,this.getPrevChapter("click"),this.bookCurrentPage--):(this.currentPaging--,this.offsetX+=e-this.margin,this.styleObject={transform:"translateX("+this.offsetX+"px)",transitionDuration:"0.5s"},this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage())}else if(a<=o&&o<=2*a)this.option=!this.option;else if(o>=2*a&&o<=e){if(this.isClickPage=!1,this.bookCurrentPage===this.bookSourceLinks.length)return void i()("已经是最后一章了！");this.currentPaging++,this.resultPaging-this.currentPaging==2&&this.getNextChapter(),this.currentPaging===this.resultPaging+1?(c.a.open("加载中..."),this.styleObject="",this.offsetX=0,this.getNextChapter("click"),this.bookCurrentPage++,this.currentPaging=1,this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage()):(this.offsetX-=e-this.margin,this.styleObject={transform:"translateX("+this.offsetX+"px)",transitionDuration:"0.5s"},this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage())}}else this.option=!this.option},bookChaptersBody:function(t){if(t){var e=s()(t).replace(/^"|"$/g,"");return this.loading=!1,/[\u4E00-\u9FA5\uF900-\uFA2D]/g.test(e)?e="<p>"+e.replace(/\s*/g,"").replace(/\\n/g,"</p><p>")+"</p>":"vip章节，请购买或者换源阅读！"}},getBookLocalStorage:function(){var t=JSON.parse(window.localStorage.getItem("book"))?JSON.parse(window.localStorage.getItem("book")):{};return t[this.$route.params.id]&&(this.flag=!0),t},setBookLocalStorage:function(){var t=JSON.parse(window.localStorage.getItem("book"))?JSON.parse(window.localStorage.getItem("book")):{};t[this.$route.params.id].chapterIndexCache=this.bookCurrentPage,t[this.$route.params.id].bookSource=this.BookSourcesId,t[this.$route.params.id].pageIndexCache=this.currentPaging,window.localStorage.setItem("book",s()(t))},_chapterIndexCache:function(){return this.getBookLocalStorage()[this.$route.params.id]?this.getBookLocalStorage()[this.$route.params.id].chapterIndexCache:0},_pageIndexCache:function(){return this.getBookLocalStorage()[this.$route.params.id]?this.getBookLocalStorage()[this.$route.params.id].pageIndexCache:1},_bookSourceId:function(){return this.getBookLocalStorage()[this.$route.params.id]?this.getBookLocalStorage()[this.$route.params.id].bookSource:0},_bookSource:function(){var t=JSON.parse(window.localStorage.getItem("tBook"))||{};return this.getBookLocalStorage()[this.$route.params.id]?this.getBookLocalStorage()[this.$route.params.id].bookSource:t[this.$route.params.id].bookSource},getBook:function(t){var e=this;Object(k.b)(t).then(function(t){e.bookInfo=t.data},function(t){c.a.close(),c.a.open("网络错误"),setTimeout(function(){c.a.close()},1500)})},getBookSources:function(t){var e=this;Object(k.f)(t).then(function(t){e.SourceList=t.data,e._bookSource()?e.getBookChapters(e.SourceList[e._bookSource()]._id):e.getBookChapters(e.SourceList[e._bookSourceId()]._id)},function(t){c.a.close(),c.a.open("网络错误"),setTimeout(function(){c.a.close()},1500)})},getBookChapters:function(t){var e=this,o=[];Object(k.a)(t).then(function(t){for(var a=0;a<t.data.chapters.length;a++)o.push(t.data.chapters[a].title),e.bookSourceLinks.push(encodeURIComponent(t.data.chapters[a].link));e.chapterList=o,e.getChapters(e.bookSourceLinks[e._chapterIndexCache()])},function(t){c.a.close(),c.a.open("网络错误"),setTimeout(function(){c.a.close()},1500)})},getChapters:function(t){var e=this;Object(k.i)(t).then(function(t){t.data.ok?(c.a.close(),t.data.chapter.cpContent?e.bookContent=e._nromalBook(t.data.chapter.title,t.data.chapter.cpContent):e.bookContent=e._nromalBook(t.data.chapter.title,t.data.chapter.body),e.getBookLocalStorage()[e.$route.params.id]&&(e.bookCurrentPage=e._chapterIndexCache(),e.currentPaging=e._pageIndexCache(),e.offsetX-=(e.currentPaging-1)*(e.clWidth-e.margin),e.styleObject={transform:"translateX("+e.offsetX+"px)",transitionDuration:"0s"})):-1===t.data.code&&(c.a.close(),e.bookSource.push({title:"找不到资源",content:"请切换书源"}),e.sourceBtn=!0)})},getPrevChapter:function(t){var e=this;Object(k.i)(this.bookSourceLinks[this.bookCurrentPage-1]).then(function(o){o.data.ok&&(c.a.close(),o.data.chapter.cpContent?(e.prevContent=e._nromalBook(o.data.chapter.title,o.data.chapter.cpContent),t&&(e.bookContent=e.prevContent)):(e.prevContent=e._nromalBook(o.data.chapter.title,o.data.chapter.body),t&&(e.bookContent=e.prevContent)))})},getNextChapter:function(t){var e=this;Object(k.i)(this.bookSourceLinks[this.bookCurrentPage+1]).then(function(o){o.data.ok&&(c.a.close(),o.data.chapter.cpContent?(e.nextContent=e._nromalBook(o.data.chapter.title,o.data.chapter.cpContent),t&&(e.bookContent=e.nextContent)):(e.nextContent=e._nromalBook(o.data.chapter.title,o.data.chapter.body),t&&(e.bookContent=e.nextContent)))})},_nromalBook:function(t,e){return new p({title:t,content:e})},loadMore:function(){var t=this;this.loading=!0,this.bookCurrentPage!==this.bookSourceLinks.length&&(this.moreLoading=!0,this.bookCurrentPage++,setTimeout(function(){t.getChapters(t.bookSourceLinks[t.bookCurrentPage]),t.getBookLocalStorage()[t.$route.params.id]&&t.setBookLocalStorage(),t.loading=!1,t.moreLoading=!1},2500))},nextChapter:function(){this.bookCurrentPage!==this.bookSourceLinks.length?(this.moreLoading=!1,this.loading=!0,c.a.open("加载中..."),this.bookSource=[],this.getNextChapter("click"),this.currentPaging=1,this.offsetX=0,this.styleObject="",this.bookCurrentPage++,this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage()):i()("已经是最后一章了！")},prevChapter:function(){0!==this.bookCurrentPage?(this.moreLoading=!1,this.loading=!0,c.a.open("加载中..."),this.bookSource=[],this.getPrevChapter("click"),this.currentPaging=1,this.offsetX=0,this.styleObject="",this.bookCurrentPage--,this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage()):i()("已经是第一章了！")}},watch:{bookContent:function(t,e){this.$refs.wrapper.scrollTop=0,1===this.pagingPattern&&this.$nextTick(function(){var t=this.$refs.bookInner.scrollWidth,e=this.$refs.bookInner.clientWidth;this.resultPaging=Math.floor(t/e),this.isClickPage&&(this.currentPaging=this.resultPaging,this.offsetX=-(this.currentPaging-1)*(this.clWidth-this.margin),this.styleObject={transform:"translateX("+this.offsetX+"px)",transitionDuration:"0s"},this.getBookLocalStorage()[this.$route.params.id]&&this.setBookLocalStorage())})}}},S={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{ref:"wrapper",staticClass:"book",style:{color:t.fontColor,background:t.background},on:{click:function(e){return t.setRead(e)}}},[0===t.pagingPattern?o("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"books-con",attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-distance":"0","infinite-scroll-immediate-check":"false"}},[o("div",{ref:"content",staticClass:"book-content"},[o("h1",{staticClass:"book-title",style:{fontSize:1.2*t.fontSize+"px"}},[t._v(t._s(t.bookContent.title))]),t._v(" "),o("div",{staticClass:"book-inner",style:{fontSize:t.fontSize+"px"},domProps:{innerHTML:t._s(t.bookChaptersBody(t.bookContent.content))}})]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.moreLoading,expression:"moreLoading"}],staticClass:"loadMore",staticStyle:{"text-align":"center"}},[o("mt-spinner",{attrs:{type:"triple-bounce",color:"#409eff"}})],1)]):t._e(),t._v(" "),0===t.bootPage?o("div",{staticClass:"bootPage",on:{click:t.setBootPage}},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2)]):t._e(),t._v(" "),1===t.pagingPattern?o("div",{staticClass:"read-content"},[o("p",{staticClass:"book-title",staticStyle:{padding:"10px"}},[t._v(t._s(t.bookContent.title))]),t._v(" "),o("div",{staticClass:"read-article"},[o("section",{staticClass:"read-section",style:t.styleObject},[o("div",{ref:"bookInner",staticClass:"read-section-inner",style:{columns:t.clWidth-20+"px",columnGap:"10px"},attrs:{id:"bookInner"}},[o("h1",{staticClass:"book-title",style:{fontSize:1.2*t.fontSize+"px"}},[t._v(t._s(t.bookContent.title))]),t._v(" "),o("div",{staticClass:"book-inner",style:{fontSize:t.fontSize+"px"},domProps:{innerHTML:t._s(t.bookChaptersBody(t.bookContent.content))}})])])]),t._v(" "),o("p",{staticClass:"article-page"},[t._v(t._s(t.currentPaging+"/"+t.resultPaging))])]):t._e()]),t._v(" "),o("div",{staticClass:"page-read-option",class:{"show-panel":t.option},on:{click:t.setReadShow}},[o("div",{staticClass:"top-controll-bar"},[o("mt-header",{staticClass:"book-header",attrs:{title:t.book.title}},[o("div",{attrs:{slot:"left"},on:{click:function(e){return t.$router.back(-1)}},slot:"left"},[o("mt-button",{attrs:{icon:"back"}},[t._v("返回")])],1),t._v(" "),o("mt-button",{staticClass:"right",attrs:{slot:"right"},on:{click:t.showSource},slot:"right"},[t._v("换源")])],1)],1),t._v(" "),o("div",{staticClass:"addReader",on:{click:t.addBookSelf}},[o("p",[t._v(t._s(t.flag?"撤出书架":"加入书架"))])]),t._v(" "),o("div",{staticClass:"bottom-controll-bar"},[o("div",{staticClass:"readSet"},[o("div",{staticClass:"readSet-item"},[o("span",{on:{click:function(e){return e.stopPropagation(),t.fontSet("reduce",e)}}},[t._v("Aa-")]),t._v(" "),o("span",{on:{click:function(e){return e.stopPropagation(),t.fontSet("add",e)}}},[t._v("Aa+")])]),t._v(" "),o("div",{staticClass:"readSet-item pattern"},t._l(t.pattern,function(e,a){return o("span",{class:{active:t.readePattern===a},on:{click:function(o){return o.stopPropagation(),t.setPattern(e,a)}}},[t._v(t._s(e.item))])}),0),t._v(" "),o("div",{staticClass:"readSet-item"},[o("span",{class:{active:0===t.pagingPattern},on:{click:function(e){return e.stopPropagation(),t.setPaging(0)}}},[t._v("上下滑动")]),t._v(" "),o("span",{class:{active:1===t.pagingPattern},on:{click:function(e){return e.stopPropagation(),t.setPaging(1)}}},[t._v("左右滑动")])])]),t._v(" "),o("mt-button",{staticStyle:{"box-shadow":"none"},attrs:{type:"default"},on:{click:t.prevChapter}},[t._v("上一章")]),t._v(" "),o("mt-button",{staticStyle:{"box-shadow":"none"},attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.setList(e)}}},[t._v("目录")]),t._v(" "),o("mt-button",{staticStyle:{"box-shadow":"none"},attrs:{type:"default"},on:{click:t.nextChapter}},[t._v("下一章")])],1)]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.listOption,expression:"listOption"}],staticClass:"chapter-list",on:{click:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"pervent",void 0,e.key,void 0)?null:(e.stopPropagation(),t.setList(e))}}},[o("div",{staticClass:"list-content"},[o("div",{staticClass:"top-bar"},[o("p",[t._v(t._s(t.bookInfo.title))])]),t._v(" "),o("div",{staticClass:"chapter-con"},[o("div",{ref:"chapterList",staticClass:"chapterList"},t._l(t.chapterList,function(e,a){return o("div",{class:{current:t.bookCurrentPage===a},on:{click:function(e){return t.selectChapter(a)}}},[t._v(t._s(e)+"\n          ")])}),0)])])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.changerSource,expression:"changerSource"}],staticClass:"changeSource",on:{click:function(e){return e.stopPropagation(),t.showSource(e)}}},[o("div",{staticClass:"source-content"},[o("ul",t._l(t.SourceList,function(e,a){return o("li",{staticClass:"source-item",on:{click:function(o){return o.stopPropagation(),t._changeSource(e,a)}}},[o("span",{staticClass:"item-left"},[t._v(t._s(e.name))]),t._v(" "),o("p",{staticClass:"center"},[t._v("最后更新："+t._s(e.lastChapter))]),t._v(" "),o("div",{staticClass:"select",class:{active:t._bookSource()===a}},[t._v("已选择")])])}),0)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"b-item bootPage-left"},[e("div",{staticClass:"center"},[e("i",{staticClass:"fa fa-angle-left"}),e("span",[this._v("点击左侧翻页")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"b-item bootPage-center"},[e("div",{staticClass:"center",staticStyle:{"text-align":"center"}},[this._v("\n          呼出菜单\n        ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"b-item bootPage-right"},[e("div",{staticClass:"center",staticStyle:{"text-align":"right"}},[e("span",[this._v("点击右侧翻页")]),e("i",{staticClass:"fa fa-angle-right"})])])}]};var b=o("C7Lr")(f,S,!1,function(t){o("t/Ue")},"data-v-593fc62c",null);e.default=b.exports},"t/Ue":function(t,e){}});
//# sourceMappingURL=6.5d4ce29b56e7f02f650f.js.map